<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>CATTLE ¬∑ Mini-App Veterinaria (Dark)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* ==================== MODO OSCURO PERMANENTE ==================== */
    :root{
      --bg:#0b1220;          /* fondo global */
      --fg:#e8eefc;          /* texto global */
      --muted:#a8b3cf;       /* texto suave */
      --card:#111a2b;        /* tarjetas */
      --card-line:#243255;   /* bordes tarjeta */
      --chip:#1f2c4e;        /* chips/badges */
      --accent:#4f46e5;      /* primario */
      --header:#0c1426;      /* topbar */
      --header-line:#18223a; /* l√≠nea topbar */
    }

    /* ===== Base ===== */
    *{box-sizing:border-box}
    body{
      margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial;
      color:var(--fg); background:var(--bg);
      -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
    }
    a{color:inherit}

    /* ===== Topbar ===== */
    .topbar{
      display:flex;justify-content:space-between;align-items:center;
      padding:12px 16px;background:var(--header);position:sticky;top:0;z-index:5;
      border-bottom:1px solid var(--header-line)
    }
    .topbar-left{display:flex;align-items:center;gap:10px}
    .topbar h1{margin:0;font-size:20px;letter-spacing:.4px}
    .topbar p{margin:0;font-size:12px;color:var(--muted)}
    .btn-menu{
      background:#1a2440;color:var(--fg);border:1px solid #263458;
      border-radius:10px;padding:8px 12px;cursor:pointer
    }
    /* el bot√≥n de tema queda oculto (tema fijo) */
    .btn-tema{display:none}

    /* ===== Home grid / cards ===== */
    .home-grid{
      display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
      gap:16px;padding:24px;max-width:1100px;margin:0 auto
    }
    .glass-card{
      background:var(--card);border:1.5px solid var(--card-borde,#334);
      border-radius:18px;padding:26px;display:flex;align-items:center;gap:12px;
      cursor:pointer;box-shadow:0 6px 20px rgba(0,0,0,.25)
    }
    .glass-card,.glass-card *{color:inherit} /* hereda blanco */
    .glass-card .icon{font-size:34px;line-height:1}
    .glass-card .title{font-weight:800;font-size:18px}

    /* ===== Filtros ===== */
    .filtros{
      display:flex;gap:14px;flex-wrap:wrap;padding:0 24px 10px;
      max-width:1100px;margin:0 auto
    }
    .filtro-item{display:flex;flex-direction:column;gap:6px}
    .filtro-item label{color:var(--muted)}
    .filtro-item select,.filtro-item input{
      background:#0f1a2f;color:var(--fg);border:1px solid #2a3a5f;
      border-radius:10px;padding:8px 10px;min-width:220px
    }

    /* ===== Listas / tarjetas ===== */
    .cards-grid{
      display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
      gap:16px;padding:16px 24px;max-width:1100px;margin:0 auto
    }
    .tarjeta-hormona,.card{
      background:var(--card);border:1px solid var(--card-line);
      border-radius:16px;padding:14px
    }
    .tarjeta-hormona h2{margin:.1rem 0 .25rem}
    .sigla{color:var(--muted)}
    .badge-sistema{
      display:inline-block;margin:.3rem 0 .6rem;background:var(--chip);
      padding:.2rem .55rem;border-radius:999px;font-size:.78rem
    }

    /* ===== F√°rmacos ===== */
    .card h3{margin:.2rem 0 .4rem}
    .farmaco-comercial span{color:var(--muted);margin-right:.35rem}
    .chip-farmaco{
      display:inline-block;color:#08111f;font-weight:700;padding:.2rem .55rem;
      border-radius:999px;margin:.3rem 0 .6rem
    }
    .card-acciones{display:flex;justify-content:flex-end;margin-top:.6rem}
    .btn-primario{
      background:var(--accent);border:none;color:#fff;padding:8px 12px;
      border-radius:10px;cursor:pointer
    }

    /* ===== Calc ===== */
    .calc-farmaco{max-width:1100px;margin:0 auto;padding:6px 24px 24px}
    .calc-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
    .calc-item label{color:var(--muted)}
    .calc-item input,.calc-item select{
      width:100%;background:#0f1a2f;color:var(--fg);border:1px solid #2a3a5f;border-radius:10px;padding:8px 10px
    }
    .calc-resultado{margin-top:10px;border:1px dashed #2a3a5f;border-radius:10px;padding:10px 12px;color:var(--fg)}

    /* ===== Sheet ===== */
    .sheet{position:fixed;inset:0;display:grid;grid-template-rows:1fr auto;z-index:50}
    .sheet[hidden]{display:none}
    .sheet__backdrop{background:rgba(0,0,0,.35)}
    .sheet__panel{background:#0e162a;border-top-left-radius:18px;border-top-right-radius:18px;padding:10px 14px 16px}
    .sheet__header{display:flex;justify-content:space-between;align-items:center;padding:4px 2px}
    .sheet__content{padding-top:6px}
    .sheet__option{
      width:100%;text-align:left;padding:12px;border-radius:12px;border:1px solid #263458;
      background:#121c34;color:var(--fg);margin:.35rem 0;display:flex;justify-content:space-between;gap:8px;cursor:pointer
    }

    /* ===== Side menu (demo) ===== */
    .side-menu{position:fixed;inset:0 40% 0 0;background:#0b1324aa;backdrop-filter:blur(2px);display:none}
    .side-menu.open{display:block}
    .side-menu header{background:#0e1730;padding:12px 16px;border-bottom:1px solid var(--card-line)}
    .side-menu .link{padding:12px 16px;border-bottom:1px dashed #25345a}
    .badge{background:#22355e;padding:2px 6px;border-radius:999px;margin-left:6px;font-size:.75rem}

    footer{padding:30px 16px;color:var(--muted);text-align:center}
    .oculto{display:none !important}
  </style>
</head>
<body>
  <!-- TOPBAR -->
  <header class="topbar">
    <div class="topbar-left">
      <button id="btn-menu" class="btn-menu" aria-label="Abrir men√∫">‚ò∞</button>
      <div class="topbar-title">
        <h1>CATTLE</h1>
        <p>Mini-app de estudio para Medicina Veterinaria</p>
      </div>
    </div>
    <!-- tema fijo; el bot√≥n queda oculto por CSS -->
    <button id="toggle-tema" class="btn-tema" disabled>Tema fijo</button>
  </header>

  <!-- CHIPS (opcional) -->
  <nav id="panel-menu" class="panel-menu oculto" style="padding:8px 24px;">
    <button class="item-menu activo" data-modulo="hormonas">üß¨ Hormonas</button>
    <button class="item-menu" data-modulo="farmacos">üíä Farmacolog√≠a</button>
  </nav>

  <!-- HOME -->
  <section id="home-grid" class="home-grid">
    <button class="glass-card" style="--card-borde:#22c55e" data-mod="fisiologia">
      <span class="icon">ü´Ä</span><span class="title">Fisiolog√≠a</span>
    </button>
    <button class="glass-card" style="--card-borde:#0ea5e9" data-mod="farmacologia">
      <span class="icon">üíâ</span><span class="title">Farmacolog√≠a</span>
    </button>
    <button class="glass-card" style="--card-borde:#f97316" data-mod="toxicologia">
      <span class="icon">‚ò†Ô∏è</span><span class="title">Toxicolog√≠a</span>
    </button>
    <button class="glass-card" style="--card-borde:#a78bfa" data-mod="anatomia">
      <span class="icon">ü¶¥</span><span class="title">Anatom√≠a</span>
    </button>
    <button class="glass-card" style="--card-borde:#ef4444" data-mod="patologia">
      <span class="icon">ü¶†</span><span class="title">Patolog√≠a</span>
    </button>
  </section>

  <!-- FILTROS HORMONAS -->
  <section id="filtros-hormonas" class="filtros oculto">
    <div class="filtro-item">
      <label for="filtro-sistema">Sistema:</label>
      <select id="filtro-sistema">
        <option value="todos">Todos</option>
        <option>Digestivo</option>
        <option>Respiratorio/Card√≠aco</option>
        <option>Card√≠aco/Circulatorio</option>
        <option>Nervioso/Neuroendocrino</option>
        <option>Renal</option>
        <option>Renal/Metab√≥lico</option>
        <option>Reproductivo</option>
        <option>Endocrino/Metab√≥lico</option>
        <option>Inmunol√≥gico</option>
        <option>√ìseo/Piel</option>
      </select>
    </div>
    <div class="filtro-item">
      <label for="filtro-especie">Especie:</label>
      <select id="filtro-especie">
        <option value="todas">Todas</option>
        <option value="multiespecie">Multiespecie</option>
        <option value="perro">Perro</option>
        <option value="gato">Gato</option>
        <option value="bovino">Bovino</option>
        <option value="equino">Equino</option>
        <option value="ovino">Ovino</option>
        <option value="caprino">Caprino</option>
        <option value="porcino">Porcino</option>
        <option value="aves">Aves</option>
      </select>
    </div>
    <div class="filtro-item filtro-busqueda">
      <label for="buscador">Buscar:</label>
      <input id="buscador" type="text" placeholder="Ej: CCK, GH, cortisol..." />
    </div>
  </section>

  <!-- LISTA HORMONAS -->
  <main id="contenedor-hormonas" class="cards-grid oculto"></main>

  <!-- FILTROS FARMA -->
  <section id="filtros-farmacos" class="filtros oculto">
    <div class="filtro-item">
      <label for="filtro-grupo-farmaco">Grupo:</label>
      <select id="filtro-grupo-farmaco">
        <option value="todos">Todos</option>
        <option value="antimicrobiano">Antimicrobianos</option>
        <option value="antiparasitario">Antiparasitarios</option>
        <option value="aine">AINEs</option>
        <option value="anestesico">Anest√©sicos / sedantes</option>
        <option value="hormona">Hormonas sint√©ticas</option>
        <option value="cardio">Cardiol√≥gicos</option>
        <option value="neuro">Neurol√≥gicos</option>
        <option value="gastrico">Protectores g√°stricos</option>
        <option value="otros">Otros de inter√©s cl√≠nico</option>
      </select>
    </div>
    <div class="filtro-item">
      <label for="filtro-especie-farmaco">Especie:</label>
      <select id="filtro-especie-farmaco">
        <option value="todas">Todas</option>
        <option value="perro">Perro</option>
        <option value="gato">Gato</option>
        <option value="bovino">Bovino</option>
        <option value="equino">Equino</option>
        <option value="ovino">Ovino</option>
        <option value="caprino">Caprino</option>
        <option value="porcino">Porcino</option>
        <option value="aves">Aves</option>
      </select>
    </div>
    <div class="filtro-item filtro-busqueda">
      <label for="buscador-farmaco">Buscar:</label>
      <input id="buscador-farmaco" type="text" placeholder="Ej: enrofloxacina, meloxicam..." />
    </div>
  </section>

  <!-- LISTA FARMA -->
  <main id="contenedor-farmacos" class="cards-grid oculto"></main>

  <!-- CALCULADORA -->
  <section id="calc-farmaco" class="calc-farmaco oculto">
    <h2>Calculadora de dosis</h2>
    <div class="calc-grid">
      <div class="calc-item">
        <label for="calc-farmaco-select">F√°rmaco:</label>
        <select id="calc-farmaco-select">
          <option value="">Selecciona un f√°rmaco‚Ä¶</option>
        </select>
      </div>
      <div class="calc-item">
        <label for="calc-especie">Especie:</label>
        <select id="calc-especie">
          <option value="">Primero elige un f√°rmaco‚Ä¶</option>
        </select>
      </div>
      <div class="calc-item">
        <label for="calc-via">V√≠a:</label>
        <select id="calc-via">
          <option value="">Primero elige especie‚Ä¶</option>
        </select>
      </div>
      <div class="calc-item">
        <label for="calc-peso">Peso del animal (kg):</label>
        <input id="calc-peso" type="number" min="0" step="0.1" placeholder="Ej: 25" />
      </div>
      <div class="calc-item calc-item-boton">
        <button id="btn-calcular" class="btn-primario">Calcular dosis</button>
      </div>
    </div>
    <div id="calc-resultado" class="calc-resultado">
      <p>Selecciona un f√°rmaco, especie, v√≠a y peso para calcular la dosis.</p>
    </div>
  </section>

  <footer>
    <small>Mini-app educativa para veterinaria üêÑüêïüêà ‚Äî by elranchodejuan_jo</small>
  </footer>

  <!-- SHEET -->
  <div id="sheet" class="sheet" role="dialog" aria-modal="true" aria-labelledby="sheet-title" hidden>
    <div class="sheet__backdrop" data-close></div>
    <div class="sheet__panel" role="document">
      <div class="sheet__header">
        <h3 id="sheet-title">Opciones</h3>
        <button class="sheet__close" data-close aria-label="Cerrar">‚úï</button>
      </div>
      <div id="sheet-content" class="sheet__content"></div>
    </div>
  </div>

  <!-- SIDE MENU -->
  <aside id="side-menu" class="side-menu">
    <header>Men√∫</header>
    <div class="link">MINI APP <span class="badge">(este sitio)</span></div>
    <div class="link">CATTLE <span class="badge">Pr√≥ximamente</span></div>
    <div class="link">Cartilla Digital <span class="badge">Pr√≥ximamente</span></div>
    <div class="link">PROTOCOLO <span class="badge">Pr√≥ximamente</span></div>
  </aside>

  <!-- ==================== SCRIPT √öNICO ==================== -->
  <script>
  console.clear();
  console.log("‚úÖ CATTLE (dark-only) listo");

  /* ---- Datos de ejemplo (borra si usas tus archivos) ---- */
  const hormonas = [
    { nombre:"Cortisol", sigla:"CORT", sistema:"Endocrino/Metab√≥lico",
      origen:"Corteza suprarrenal", funcion:"Respuesta al estr√©s",
      patologia:"‚Üì Addison\n‚Üë Cushing", secundarias:"Metabolismo glucosa",
      variaciones:"Perro > Gato (respuesta)", farmaco:"Glucocorticoides", especies:["multiespecie"] },
    { nombre:"Colecistoquinina", sigla:"CCK", sistema:"Digestivo",
      origen:"Duodeno", funcion:"Secreci√≥n pancre√°tica y contracci√≥n ves√≠cula",
      patologia:"‚Äî", secundarias:"Saciaci√≥n", variaciones:"‚Äî", farmaco:"‚Äî", especies:["multiespecie"] }
  ];
  const farmacos = [
    { nombre:"Enrofloxacina", nombreComercial:"Baytril¬Æ", grupo:"Antimicrobiano",
      vias:["IM","SC","Oral"], especies:["perro","gato","bovino","aves"],
      indicaciones:"Infecciones bacterianas", contraindicaciones:"Cachorros en crecimiento",
      dosis:"5‚Äì10 mg/kg", retiro:"Bovinos de carne: 7‚Äì10 d√≠as", notas:"Fluoroquinolona",
      dosisEspecies:{
        perro:{ mgKg:10, concMgMl:50, vias:["IM","Oral"], frecuencia:"cada 24 h", dias:"5‚Äì10" },
        gato:{ mgKg:5, concMgMl:25, vias:["Oral"], frecuencia:"cada 24 h", dias:"5‚Äì7" },
        bovino:{ mgKg:7.5, concMgMl:100, vias:["SC","IM"], frecuencia:"cada 24 h", dias:"3‚Äì5" }
      }
    },
    { nombre:"Meloxicam", nombreComercial:"Metacam¬Æ", grupo:"AINE",
      vias:["IM","IV","Oral"], especies:["perro","gato","bovino","equino"],
      indicaciones:"Dolor/inflamaci√≥n", contraindicaciones:"√ölcera GI, IR",
      dosis:"0.2 mg/kg carga; 0.1 mg/kg mantenimiento", retiro:"seg√∫n especie", notas:"COX-2 preferente",
      dosisEspecies:{
        perro:{ mgKg:0.1, concMgMl:1.5, vias:["Oral"], frecuencia:"cada 24 h", dias:"3‚Äì5" },
        gato:{ mgKg:0.05, concMgMl:0.5, vias:["Oral"], frecuencia:"cada 24 h", dias:"m√°x 3" }
      }
    }
  ];

  /* ---------- Datos seguros ---------- */
  const HORMONAS = Array.isArray(hormonas) ? hormonas : [];
  const FARMACOS = Array.isArray(farmacos) ? farmacos : [];
  HORMONAS.forEach(h => { if (!h.especies) h.especies = ["multiespecie"]; });

  /* ---------- DOM ---------- */
  const filtroSistema = document.getElementById("filtro-sistema");
  const filtroEspecie = document.getElementById("filtro-especie");
  const buscador      = document.getElementById("buscador");

  const filtroGrupoFarmaco   = document.getElementById("filtro-grupo-farmaco");
  const filtroEspecieFarmaco = document.getElementById("filtro-especie-farmaco");
  const buscadorFarmaco      = document.getElementById("buscador-farmaco");

  const contHormonas = document.getElementById("contenedor-hormonas");
  const contFarmacos = document.getElementById("contenedor-farmacos");

  const filtrosHormonasSec = document.getElementById("filtros-hormonas");
  const filtrosFarmacosSec = document.getElementById("filtros-farmacos");

  const btnMenu  = document.getElementById("btn-menu");
  const sideMenu = document.getElementById("side-menu");

  const homeGrid = document.getElementById("home-grid");

  const sheet        = document.getElementById("sheet");
  const sheetBackdrop= sheet.querySelector(".sheet__backdrop");
  const sheetTitle   = sheet.querySelector("#sheet-title");
  const sheetContent = sheet.querySelector("#sheet-content");
  const sheetClose   = sheet.querySelector(".sheet__close");

  const calcPanel      = document.getElementById("calc-farmaco");
  const selFarmacoCalc = document.getElementById("calc-farmaco-select");
  const selEspecieCalc = document.getElementById("calc-especie");
  const selViaCalc     = document.getElementById("calc-via");
  const inputPesoCalc  = document.getElementById("calc-peso");
  const btnCalcular    = document.getElementById("btn-calcular");
  const resultadoCalc  = document.getElementById("calc-resultado");

  const show = el => el.classList.remove("oculto");
  const hide = el => el.classList.add("oculto");
  let moduloActual = "home";

  /* ---------- Sheet ---------- */
  function openSheet(title, options=[]){
    sheetTitle.textContent = title;
    sheetContent.innerHTML = "";
    options.forEach(opt=>{
      const b=document.createElement("button");
      b.className="sheet__option";
      b.innerHTML=`<span>${opt.label}</span><span>${opt.suffix||""}</span>`;
      if(opt.disabled){ b.disabled=true; b.style.opacity=".55"; }
      else b.addEventListener("click",()=>{ closeSheet(); opt.onClick && opt.onClick(); });
      sheetContent.appendChild(b);
    });
    sheet.removeAttribute("hidden");
  }
  function closeSheet(){ sheet.setAttribute("hidden",""); }
  sheetBackdrop.addEventListener("click",closeSheet);
  sheetClose.addEventListener("click",closeSheet);

  /* ---------- Navegaci√≥n ---------- */
  function cambiarModulo(mod){
    moduloActual = mod;
    if(mod==="home"){
      show(homeGrid);
      hide(filtrosHormonasSec); hide(contHormonas);
      hide(filtrosFarmacosSec); hide(contFarmacos); hide(calcPanel);
      return;
    }
    hide(homeGrid);
    if(mod==="hormonas"){
      show(filtrosHormonasSec); show(contHormonas);
      hide(filtrosFarmacosSec); hide(contFarmacos); hide(calcPanel);
      renderHormonas([],false);
    }else if(mod==="farmacos"){
      hide(filtrosHormonasSec); hide(contHormonas);
      show(filtrosFarmacosSec); show(contFarmacos); show(calcPanel);
      renderFarmacos([]);
    }
  }

  document.querySelectorAll(".glass-card").forEach(card=>{
    card.addEventListener("click",()=>{
      const mod = card.dataset.mod;
      if(mod==="fisiologia"){
        openSheet("Fisiolog√≠a",[
          {label:"Hormonas (activo)", onClick:()=>cambiarModulo("hormonas")},
          {label:"Vitaminas (pr√≥x.)", disabled:true, suffix:"üîí"}
        ]);
      }else if(mod==="farmacologia"){
        openSheet("Farmacolog√≠a",[
          {label:"Vadem√©cum (activo)", onClick:()=>{cambiarModulo("farmacos"); window.scrollTo({top:0,behavior:"smooth"});}},
          {label:"Calculadora (activa)", onClick:()=>{cambiarModulo("farmacos"); calcPanel.scrollIntoView({behavior:"smooth"});}},
        ]);
      }else if(mod==="toxicologia"){
        openSheet("Toxicolog√≠a",[{label:"M√≥dulos (pr√≥x.)", disabled:true, suffix:"üîí"}]);
      }else if(mod==="anatomia"){
        openSheet("Anatom√≠a",[{label:"Atlas (pr√≥x.)", disabled:true, suffix:"üîí"}]);
      }else if(mod==="patologia"){
        openSheet("Patolog√≠a",[{label:"Protocolos (pr√≥x.)", disabled:true, suffix:"üîí"}]);
      }
    });
  });

  /* ---------- Side menu ---------- */
  btnMenu.addEventListener("click",()=>sideMenu.classList.toggle("open"));
  sideMenu.addEventListener("click",(e)=>{ if(e.target===sideMenu) sideMenu.classList.remove("open"); });

  /* ---------- Hormonas ---------- */
  function claseSistema(s){ s=(s||"").toLowerCase();
    if(s.startsWith("digestivo")) return "sis-digestivo";
    if(s.startsWith("respiratorio/card√≠aco")) return "sis-respiratorio-card√≠aco";
    if(s.startsWith("card√≠aco/circulatorio")) return "sis-card√≠aco-circulatorio";
    if(s.startsWith("nervioso/neuroendocrino")) return "sis-nervioso-neuroendocrino";
    if(s.startsWith("renal/metab√≥lico")) return "sis-renal-metab√≥lico";
    if(s.startsWith("renal")) return "sis-renal";
    if(s.startsWith("reproductivo")) return "sis-reproductivo";
    if(s.startsWith("endocrino/metab√≥lico")) return "sis-endocrino-metab√≥lico";
    if(s.startsWith("inmunol√≥gico")) return "sis-inmunol√≥gico";
    if(s.startsWith("√≥seo/piel")) return "sis-√≥seo-piel";
    return "";
  }

  function renderHormonas(lista,filtrosAplicados){
    contHormonas.innerHTML="";
    if(!filtrosAplicados){
      contHormonas.innerHTML=`<p class="mensaje-inicial" style="color:var(--muted)">Usa los filtros o busca para ver hormonas.</p>`;
      return;
    }
    if(!lista.length){ contHormonas.innerHTML=`<p>No se encontraron hormonas.</p>`; return; }
    lista.forEach(h=>{
      const card=document.createElement("article");
      card.className=`tarjeta-hormona ${claseSistema(h.sistema)}`;
      card.innerHTML=`
        <h2>${h.nombre}</h2>
        <div class="sigla">Sigla: <strong>${h.sigla||"-"}</strong></div>
        <span class="badge-sistema">${h.sistema}</span>
        <p><strong>Origen:</strong><br>${(h.origen||"").replace(/\n/g,"<br>")}</p>
        <p><strong>Funci√≥n principal:</strong> ${h.funcion||"‚Äî"}</p>
        <p><strong>Patolog√≠a (‚Üì/‚Üë):</strong><br>${(h.patologia||"").replace(/\n/g,"<br>")}</p>
        <p><strong>Funciones secundarias:</strong> ${h.secundarias||"‚Äî"}</p>
        <p><strong>Variaciones por especie:</strong> ${h.variaciones||"‚Äî"}</p>
        <p><strong>Afecciones farmacol√≥gicas:</strong> ${h.farmaco||"‚Äî"}</p>`;
      contHormonas.appendChild(card);
    });
  }

  function aplicarFiltrosHormonas(){
    const sistemaSel = filtroSistema.value;
    const especieSel = filtroEspecie.value;
    const texto      = (buscador.value||"").toLowerCase().trim();
    const filtrosAplicados = sistemaSel!=="todos" || especieSel!=="todas" || texto!=="";
    const filtradas = HORMONAS.filter(h=>{
      const okS = sistemaSel==="todos" || h.sistema===sistemaSel;
      const okE = especieSel==="todas" || (h.especies||[]).map(e=>e.toLowerCase()).includes(especieSel);
      const okT = !texto || [h.nombre,h.sigla,h.sistema,h.funcion,h.patologia,h.variaciones,h.farmaco]
        .filter(Boolean).some(v=>v.toLowerCase().includes(texto));
      return okS && okE && okT;
    });
    renderHormonas(filtradas,filtrosAplicados);
  }

  /* ---------- F√°rmacos ---------- */
  const coloresFarmacos={antimicrobiano:"#4cc9f0",antiparasitario:"#80ed99",aine:"#f4a261",anestesico:"#9d4edd",
    hormona:"#ffb703",cardio:"#ef476f",neuro:"#6d597a",gastrico:"#219ebc",otros:"#adb5bd"};

  function renderFarmacos(lista=[]){
    const base = lista.length?lista:FARMACOS;
    contFarmacos.innerHTML="";
    if(!base.length){ contFarmacos.innerHTML=`<p>No se encontraron f√°rmacos.</p>`; return; }
    base.forEach(f=>{
      const index = FARMACOS.indexOf(f);
      const card=document.createElement("article");
      card.className="card card-farmaco"; card.dataset.index=index;

      const grupoRaw = (f.grupo||"").toString();
      let grupoClave = grupoRaw.split("‚Äì")[0].trim().toLowerCase();
      if (grupoClave==="cardiol√≥gico"||grupoClave==="cardiologicos") grupoClave="cardio";
      if (grupoClave==="a.i.n.e") grupoClave="aine";
      if (grupoClave==="neurol√≥gicos") grupoClave="neuro";
      if (grupoClave==="anestesico") grupoClave="anestesico";
      f.grupoClave = grupoClave;

      const color = coloresFarmacos[grupoClave] || "#888";
      card.style.setProperty("--borde-farmaco", color);

      const vias = f.vias?.join(", ") || f.via || "‚Äî";
      const especies = f.especies?.join(", ") || "‚Äî";

      card.innerHTML=`
        <h3>${f.nombre}</h3>
        <p class="farmaco-comercial"><span>Nombre comercial:</span> ${f.nombreComercial||"‚Äî"}</p>
        <div class="chip-farmaco" style="background:${color}">${grupoRaw||"‚Äî"}</div>
        <p><strong>V√≠as:</strong> ${vias}</p>
        <p><strong>Especies:</strong> ${especies}</p>
        <p><strong>Indicaciones:</strong> ${f.indicaciones||"‚Äî"}</p>
        <p><strong>Contraindicaciones:</strong> ${f.contraindicaciones||"‚Äî"}</p>
        <p><strong>Dosis general:</strong> ${f.dosis||"‚Äî"}</p>
        <p><strong>Per√≠odo de retiro:</strong> ${f.retiro||"‚Äî"}</p>
        <p><strong>Notas:</strong> ${f.notas||"‚Äî"}</p>
        <div class="card-acciones"><button class="btn-primario btn-desde-card">Usar en calculadora</button></div>`;
      contFarmacos.appendChild(card);
    });
  }

  function aplicarFiltrosFarmacos(){
    const grupoSel   = filtroGrupoFarmaco.value;
    const especieSel = filtroEspecieFarmaco.value;
    const texto      = (buscadorFarmaco.value||"").toLowerCase().trim();

    const filtradas = FARMACOS.filter(f=>{
      const okG = grupoSel==="todos" || f.grupoClave===grupoSel;
      const okE = especieSel==="todas" || (f.especies||[]).map(e=>e.toLowerCase()).includes(especieSel);
      const okT = !texto || [f.nombre,f.nombreComercial,f.grupo,f.indicaciones,f.contraindicaciones]
        .filter(Boolean).some(v=>v.toLowerCase().includes(texto));
      return okG && okE && okT;
    });
    renderFarmacos(filtradas);
  }

  /* Card ‚Üí calculadora */
  contFarmacos.addEventListener("click",(ev)=>{
    const btn = ev.target.closest(".btn-desde-card"); if(!btn) return;
    const card = btn.closest(".card-farmaco"); if(!card) return;
    const idx = card.dataset.index;
    const f = FARMACOS[parseInt(idx,10)]; if(!f) return;

    selFarmacoCalc.value = String(idx);
    selFarmacoCalc.dispatchEvent(new Event("change"));
    if (f.dosisEspecies){
      const especiesCalc = Object.keys(f.dosisEspecies);
      if(especiesCalc.length===1){
        selEspecieCalc.value = especiesCalc[0];
        selEspecieCalc.dispatchEvent(new Event("change"));
      }
    }
    cambiarModulo("farmacos");
    calcPanel.scrollIntoView({behavior:"smooth"});
  });

  /* Eventos de filtros */
  filtroSistema.addEventListener("change",aplicarFiltrosHormonas);
  filtroEspecie.addEventListener("change",aplicarFiltrosHormonas);
  buscador.addEventListener("input",aplicarFiltrosHormonas);

  filtroGrupoFarmaco.addEventListener("change",aplicarFiltrosFarmacos);
  filtroEspecieFarmaco.addEventListener("change",aplicarFiltrosFarmacos);
  buscadorFarmaco.addEventListener("input",aplicarFiltrosFarmacos);

  /* Calculadora */
  function poblarSelectFarmacos(){
    selFarmacoCalc.innerHTML='<option value="">Selecciona un f√°rmaco‚Ä¶</option>';
    FARMACOS.forEach((f,idx)=>{
      const opt=document.createElement("option"); opt.value=String(idx); opt.textContent=f.nombre;
      selFarmacoCalc.appendChild(opt);
    });
  }

  selFarmacoCalc.addEventListener("change",()=>{
    selEspecieCalc.innerHTML='<option value="">Elige especie‚Ä¶</option>';
    selViaCalc.innerHTML    ='<option value="">Primero especie‚Ä¶</option>';
    resultadoCalc.innerHTML ='<p>Selecciona especie, v√≠a y peso para calcular.</p>';
    const idx=selFarmacoCalc.value; if(!idx) return;
    const f=FARMACOS[parseInt(idx,10)]; if(!f?.dosisEspecies) return;
    Object.keys(f.dosisEspecies).forEach(esp=>{
      const opt=document.createElement("option");
      opt.value=esp; opt.textContent=esp.charAt(0).toUpperCase()+esp.slice(1);
      selEspecieCalc.appendChild(opt);
    });
  });

  selEspecieCalc.addEventListener("change",()=>{
    selViaCalc.innerHTML='<option value="">Elige v√≠a‚Ä¶</option>';
    resultadoCalc.innerHTML='<p>Selecciona v√≠a y peso para calcular.</p>';
    const idx=selFarmacoCalc.value; const especie=selEspecieCalc.value; if(!idx||!especie) return;
    const info=FARMACOS[parseInt(idx,10)]?.dosisEspecies?.[especie]; if(!info) return;
    (info.vias||[]).forEach(v=>{ const opt=document.createElement("option"); opt.value=v; opt.textContent=v; selViaCalc.appendChild(opt); });
  });

  btnCalcular.addEventListener("click",()=>{
    const idx=selFarmacoCalc.value, especie=selEspecieCalc.value, via=selViaCalc.value;
    const peso=parseFloat(inputPesoCalc.value);
    if(!idx||!especie||!via||isNaN(peso)||peso<=0){ resultadoCalc.innerHTML='<p>Completa todo y usa un peso v√°lido.</p>'; return; }
    const f=FARMACOS[parseInt(idx,10)]; const info=f?.dosisEspecies?.[especie];
    if(!info){ resultadoCalc.innerHTML='<p>No hay datos de dosis para esa especie.</p>'; return; }
    const mgKg=info.mgKg, conc=info.concMgMl??null, dosis=peso*mgKg, vol=conc?(dosis/conc):null;
    let html=`
      <p><strong>F√°rmaco:</strong> ${f.nombre}</p>
      <p><strong>Especie:</strong> ${especie}</p>
      <p><strong>V√≠a:</strong> ${via}</p>
      <p><strong>Dosis:</strong> ${mgKg} mg/kg</p>
      <p><strong>Peso:</strong> ${peso.toFixed(2)} kg</p>
      <p><strong>Total:</strong> ${dosis.toFixed(2)} mg</p>`;
    if(vol!==null) html+=`<p><strong>Concentraci√≥n:</strong> ${conc} mg/ml ‚Üí <strong>Volumen:</strong> ${vol.toFixed(2)} ml</p>`;
    html+=`<p><strong>Frecuencia (estudio):</strong> ${info.frecuencia||"‚Äî"}</p>
           <p><strong>D√≠as (estudio):</strong> ${info.dias||"‚Äî"}</p>
           <p style="margin-top:.4rem;font-size:.78rem;color:#f97316;">‚ö† Herramienta de estudio: valida siempre con vadem√©cum y norma local.</p>`;
    resultadoCalc.innerHTML=html;
  });

  /* Estado inicial */
  poblarSelectFarmacos();
  cambiarModulo("home");
  </script>
</body>
</html>
